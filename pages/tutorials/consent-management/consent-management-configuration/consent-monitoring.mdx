import { Callout } from 'nextra-theme-docs'
import TutorialKey from 'components/tutorialkey'
import Screenshot from 'components/screenshot'

# Consent Management: Consent Reporting

<TutorialKey duration="10" product="Fides" topic="Consent Management"/>

<Callout emoji=""> This tutorial requires Fides Cloud or Fides Enterprise. For more information, [talk to our solutions team.](https://ethyca.com/book-demo?utm_source=docs-site) </Callout>

In this tutorial, we'll review the different options available to run reports on saved consent preferences.

There are three main options for reporting:

1. Download saved consent preferences from Fides Cloud as a CSV file for manual reporting
2. Query saved consent preferences from the Fides API for automated reporting
3. Integrate consent events from FidesJS into your frontend product analytics for real-time reporting

After reading this, you'll be familiar with the different methods available to track both opt-in and opt-out choices made by your users.

## Prerequisites

For this tutorial you'll need:

- A Fides Cloud or Fides Enterprise account
- A functioning consent implementation
- Knowledge about your own preferred reporting tools for CSV analysis, API integrations, or event analytics

## Option 1: Download CSV Reports from Fides

Fides provides the ability to download basic consent reporting as a CSV via the Admin UI. This beta feature can be enabled on the About Fides page and then found under Consent at the consent reporting page.

Provide a date range and you can have a CSV downloaded. There are some size-dependent guardrails in place today meaning date ranges may need to be narrowed.

<Screenshot img="/docs/assets/img/tutorials/consent-management/consent-reporting-ui.png" description="Privacy Preferences Reporting UI" />

## Option 2: Using the API

Fides comes with an expansive API that can cover a multitude of use-cases, including tracking [historical privacy preferences](/dev-docs/api/manage/historical-privacy-preferences).

To collect the fullest picture possible, your data team can set up a pipeline using the `/api/v1/historical-privacy-preferences` endpoint. With opt-in by default consent, it's important to remember to pair this data alongside traffic counts to ensure a full picture!

<Screenshot img="/docs/assets/img/tutorials/consent-management/privacy-preferences.png" description="Privacy Preferences API" />

The flow should look like:

1. Create a new `client_id`/`client_secret` with the scope of `consent:read` (reach out to your Customer Success Manager if using Fides Cloud)
2. Authenticate to get a token `POST /api/v1/oauth/token`
3. Query `GET /api/v1/historical-privacy-preferences` (paginated results)

## Option 3: Integrating FidesJS consent events into your event analytics tool

When running on a user's browser, FidesJS will automatically emit a `FidesUpdated` event to the `window` object with the user's saved consent preferences. You can subscribe to this event to track changes to user consent (e.g. opt-in, opt-out) and other details such as the consent method (e.g. save, dismiss).

```
window.addEventListener("FidesUpdated", (event) => {
  const consent = event.detail.consent; // e.g. { marketing: true, analytics: false }
  const extraDetails = event.detail.extraDetails; // e.g. { consentMethod: "save" }
  console.log("Received 'FidesUpdated' event from FidesJS!");
  console.log("Updated user consent preferences:", consent);
  console.log("Extra event details:", extraDetails);
});
```
